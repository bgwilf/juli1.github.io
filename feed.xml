<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Julien Delange</title>
    <description>Tales of a guy living in Pittsburgh addicted to Computer-Science, Running and Peanut Butter</description>
    <link>http://julien.gunnm.org/</link>
    <atom:link href="http://julien.gunnm.org/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Sat, 05 Aug 2017 15:35:50 -0700</pubDate>
    <lastBuildDate>Sat, 05 Aug 2017 15:35:50 -0700</lastBuildDate>
    <generator>Jekyll v3.2.1</generator>
    
      <item>
        <title>How to prepare for an interview at Amazon</title>
        <description>&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: I am currently a Senior SDE at Amazon Web Services (and &lt;a href=&quot;https://www.linkedin.com/in/juli1&quot;&gt;I am hiring&lt;/a&gt;, my team
is &lt;em&gt;awesome&lt;/em&gt;, please message me if you are interested). Opinions there are my own and does not represent the one from my
employer.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.amazon.com&quot;&gt;Amazon&lt;/a&gt; is a major tech company and 
is a leader in many domains, which gives a lot of jobs opportunities (like working on Cloud Computing via &lt;a href=&quot;http://aws.amazon.com&quot;&gt;Amazon
Web Services&lt;/a&gt;, Retail via
&lt;a href=&quot;http://www.amazon.com&quot;&gt;Amazon.com&lt;/a&gt; or Virtual Assistant via
&lt;a href=&quot;http://alexa.amazon.com]&quot;&gt;Alexa&lt;/a&gt;. Thousands of people want to work there
and the interview is &lt;strong&gt;hard&lt;/strong&gt;.
This is very common to find people frustrated because they have been rejected,
like this on &lt;a href=&quot;http://www.quora.com&quot;&gt;Quora&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/interview-rejection.png&quot; alt=&quot;Interview Rejection Post on Quora&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The interview is hard and even if you &lt;em&gt;think&lt;/em&gt; you did great, you probably did not. 
&lt;strong&gt;Reality check&lt;/strong&gt;: this is really hard to get another perspective (see pic below). And unfortunately,
we probably do not perform as good as we think most of the time.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/rhino.jpg&quot; alt=&quot;Rhino&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As a senior SDE working there, I wanted to share some advices on how to prepare
for your interview. These advices are mine and are limited to my knowledge and experience.
Do not consider them as the only good practices, these are just my perspective (see pic above).&lt;/p&gt;

&lt;h1 id=&quot;demystify-the-interview&quot;&gt;Demystify the interview&lt;/h1&gt;
&lt;p&gt;First of all, do not focus too much on the outcome on the interview. Hope and shoot for the best
but keep in mind it might not happen.&lt;/p&gt;

&lt;p&gt;Interviewing is like dating. You prepare, you try to be at your best and you will be
stressed. This shows that you care about the job. But if it does not work out, no worries, 
there are plenty of fish in the sea. But if it works, you do not have
to seal the deal right away: a company that is rejected by a candidate is likely to come back later.&lt;/p&gt;

&lt;p&gt;But first thing first, you &lt;strong&gt;have to be prepared&lt;/strong&gt;.&lt;/p&gt;

&lt;h1 id=&quot;work-on-coding-know-your-basics&quot;&gt;Work on coding. Know your basics&lt;/h1&gt;
&lt;p&gt;The general advice, no matter the tech company is to know your basics:
algorithms, data structure, complexity, you &lt;strong&gt;have to know&lt;/strong&gt; these topics.
If you do not know, do not even go and try, you will waste your time.&lt;/p&gt;

&lt;p&gt;I would advice to read at list two books:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://elementsofprogramminginterviews.com/&quot;&gt;Elements of Programming Interviews&lt;/a&gt;: the most complete
 resource to be prepared for algorithmic, design and other technical aspects&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.crackingthecodinginterview.com/&quot;&gt;Cracking the Code Interview&lt;/a&gt;: a
 good second book that explains also what to expect during the interview.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you think you already know your basics and you do not need this, think twice.
Reading &lt;em&gt;Elements of Programming Interviews&lt;/em&gt; will definitively refresh your skills.&lt;/p&gt;

&lt;p&gt;You can also go for a mock interview, a coding bootcamp. Whatever. Be ready to write
code on whiteboard and answer to some basic questions.&lt;/p&gt;

&lt;h1 id=&quot;know-the-leadership-principles-&quot;&gt;Know the leadership principles …&lt;/h1&gt;
&lt;p&gt;Technical (coding/system design) skills constitute 100% of a hiring decision. The other 100% is guided
by the leadership principles. The ratio might be be accurate (no kidding!), but what I want to highlight there
is that most books and advices do not dive deep on this topic while this is very important. Knowing
the leadership principles shows your culture fit and your understanding of the company principles. If you do not know them:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Learn them.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Right.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Now.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.amazon.jobs/principles&quot;&gt;https://www.amazon.jobs/principles&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Learn and show you understand them. Connect your own experience with these principles.
Explain how you apply &lt;em&gt;customer obsession&lt;/em&gt;, &lt;em&gt;frugality&lt;/em&gt;, &lt;em&gt;bias for action&lt;/em&gt; or &lt;em&gt;learn and be curious&lt;/em&gt; in your
actual job. Doing this will prepare you for your interview.&lt;/p&gt;

&lt;p&gt;This is an important part of an interview because these principles
drive our work every day in the company. &lt;strong&gt;Showing that you
understand and follow these principles is key&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Also, do not make up stories, &lt;strong&gt;be sincere, real&lt;/strong&gt;. If you do not know something, say it
and ask for more clarifications or to have another question to evaluate you. This is very easy for an interviewer
to see when somebody is making up a story.&lt;/p&gt;

&lt;h2 id=&quot;and-do-basic-search-about-the-company&quot;&gt;… and do basic search about the company&lt;/h2&gt;

&lt;p&gt;Learn about the job and do some research about the division you are interviewing for (lab126, AWS, etc.).
Know the products they are developing. This will show you are interested about the job and you care about it.
Do not overdo it, just know the basic information: products, target, overall development plan, major leaders, etc.&lt;/p&gt;

&lt;h1 id=&quot;practice-a-lot&quot;&gt;Practice a lot&lt;/h1&gt;

&lt;p&gt;Practice, every day. Start with practicing on &lt;a href=&quot;http://www.leetcode.com&quot;&gt;leetcode&lt;/a&gt;, &lt;a href=&quot;http://www.geeksforgeeks.org/&quot;&gt;geeksforgeeks&lt;/a&gt; or any other
online coding site. Solve at least 4 problems a day (for example, 2 in the
morning, 2 in the evening). Make sure you solved at least 4 to 5 problems in
every category (arrays, tree, linked-list, etc.) before scheduling any interview
(even a mock).&lt;/p&gt;

&lt;p&gt;Buy a &lt;a href=&quot;https://www.amazon.com/Lifetree-Stick-Message-Sticker-78-7-Inch/dp/B015O5QOY6/ref=sr_1_3?ie=UTF8&amp;amp;qid=1500784523&amp;amp;sr=8-3&amp;amp;keywords=whiteboard+sticker&quot;&gt;whiteboard&lt;/a&gt;.
It costs nothing (~$10) and will help you to practice in real conditions.&lt;/p&gt;

&lt;p&gt;Do not bother having a coach. This is non-sense, a waste of time and money.
Just work hard, every day for several weeks in a row. Stop coding on your
computer and switch to the whiteboard exclusively.&lt;/p&gt;

&lt;h1 id=&quot;go-out-and-interview-periodically&quot;&gt;Go out and interview periodically&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;Interviewing is like a muscle&lt;/strong&gt;: you need to practice so that you do not loose your
ability to interview. Even if you are at your dream job today, continue
to practice to keep it strong. This is very important to keep this ability up and
running. You can do that in different ways: you can either practice with a
friend or just apply to positions to evaluate yourself.&lt;/p&gt;

&lt;p&gt;Remember, interviewing is like dating, you can go interview but &lt;em&gt;do not have
to&lt;/em&gt; accept any offer. If you refuse, the other party will contact
you later to check what you are up to. And even if you refuse it, 
having a nice offer will boost your ego and give your value
on the market (always good to take!).&lt;/p&gt;

&lt;h1 id=&quot;same-player-try-again&quot;&gt;Same player, try again&lt;/h1&gt;

&lt;p&gt;Even if you prepare at your best, there is still a chance you will not be
selected. There are many reasons a candidate will not receive an offer. Your
goal is to be prepared at best to reduce the probably of being rejected.
But it can happen for various reasons. &lt;strong&gt;And that is ok&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Do not take this personal. Consider this as a learning opportunity to
improve and re-apply few months after. After few days, you will know where you
probably made a mistake and can work on improving. The process is generally
oriented towards false positive, this is why recruiters will probably re-contact
after a few months to re-apply.&lt;/p&gt;

&lt;p&gt;Good luck!&lt;/p&gt;

</description>
        <pubDate>Fri, 21 Jul 2017 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/amazon/techjob/interview/2017/07/21/how-to-prepare-for-an-interview-at-amazon/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/amazon/techjob/interview/2017/07/21/how-to-prepare-for-an-interview-at-amazon/</guid>
        
        <category>amazon</category>
        
        <category>interview</category>
        
        
        <category>amazon</category>
        
        <category>techjob</category>
        
        <category>interview</category>
        
      </item>
    
      <item>
        <title>AADL In Practice is OUT!</title>
        <description>&lt;p&gt;After more than 4 months of intense work, I am happy to announce that my first book, &lt;em&gt;AADL In Practice&lt;/em&gt;
is now available online! The book is a guide to walk you through the AADL language, explains its syntax
and semantics and helps you to extend it for your own needs. All of this for $4.99.&lt;/p&gt;

&lt;p&gt;This is a nice way to give back to the AADL community and close a chapter of the research work I started
almost 10 years ago. I wanted to make my research work available. Not having these expensives books about
complicated stuff. I wanted to do something simple, quick. Something most of engineers can understand
and reuse for their own needs. I hope this will be useful for the software engineering community.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.amazon.com/dp/B071WHRJY3&quot;&gt;Amazon e-book&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.aadl-info.com&quot;&gt;Book website&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.facebook.com/aadlinpractice/&quot;&gt;Like the book on facebook&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://www.amazon.com/dp/B071WHRJY3&quot;&gt;&lt;img src=&quot;/assets/aadl-book-3d.jpg&quot; alt=&quot;AADL In Practice&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Sat, 03 Jun 2017 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/architecture/modeling/2017/06/03/aadl-book/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/architecture/modeling/2017/06/03/aadl-book/</guid>
        
        <category>aadl</category>
        
        <category>modeling</category>
        
        
        <category>architecture</category>
        
        <category>modeling</category>
        
      </item>
    
      <item>
        <title>Why using asynchronous communications?</title>
        <description>&lt;p&gt;&lt;strong&gt;TL;DR: this blog post explains the status of async communications&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;It all started when I watched a video online:
&lt;a href=&quot;https://www.youtube.com/watch?v=gaOa-Dsbb4o&quot;&gt;Scaling Server Software at Facebook&lt;/a&gt;. The video
gives interesting details used at facebook to optimize their systems. One of the big advice (among many others)
is to use asynchronous communications. I wanted see the benefit of using
asynchronous communication and how it compares with the traditional synchronous model.&lt;/p&gt;

&lt;p&gt;This blog post explains first the different between synchronuous and asynchronuous I/O,
presents the programming models and gives some rough estimates of what you can expect.
If you develop a massive ditributed system, you cannot avoid asynchronuous communications.&lt;/p&gt;

&lt;h1 id=&quot;synchronous-vs-asynchronous-io&quot;&gt;Synchronous vs. asynchronous I/O&lt;/h1&gt;

&lt;p&gt;Let’s first start by explaining what is the difference between synchronous and asynchronuous
communications. A distributed application communicate by performing I/Os (Input/Output). It can
be network communications (socket), reading/writing into a file, etc.
In the &lt;a href=&quot;https://en.wikipedia.org/wiki/Unix&quot;&gt;UNIX&lt;/a&gt;/
&lt;a href=&quot;https://en.wikipedia.org/wiki/POSIX&quot;&gt;POSIX&lt;/a&gt; world, I/O are performed
on file descriptors (FDs): when you open a file or a network communication,
you open a file descriptor and can then perform &lt;code class=&quot;highlighter-rouge&quot;&gt;read()&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;write()&lt;/code&gt; operations on it.&lt;/p&gt;

&lt;p&gt;You have two ways to perform I/Os: &lt;strong&gt;synchronously&lt;/strong&gt; and &lt;strong&gt;asynchronously&lt;/strong&gt;. When using
&lt;strong&gt;synchronous&lt;/strong&gt; I/O, the caller is block until the call succeeds. When using &lt;strong&gt;asynchronuous&lt;/strong&gt;, you
are periodically checking if there is anything received. The next sections details these two worlds.&lt;/p&gt;

&lt;h2 id=&quot;the-synchronous-world&quot;&gt;The synchronous world&lt;/h2&gt;

&lt;p&gt;In the synchronous world, you wait for a reply. For example, if you call &lt;code class=&quot;highlighter-rouge&quot;&gt;read()&lt;/code&gt; on a network socket,
your current program will wait until some data is available.&lt;/p&gt;

&lt;p&gt;This communication pattern is very similar to a phone conversation: you talk first and then, wait for
a reply from the other side.&lt;/p&gt;

&lt;p&gt;Synchronous communication are very sequential. Most of the time, you perform a
series of operations as follow:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Open the communication channel (e.g. take your phone and dial your friend)&lt;/li&gt;
  &lt;li&gt;Do several exchanges (e.g. each person talks and wait for the answer of the other person)&lt;/li&gt;
  &lt;li&gt;Close the communication channel (hangup)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This model is fine when you have one communication happenning. The problem is when your application
is massively distributed and communicate with a lot of peers. In that case, you need
to have N tasks (also called &lt;a href=&quot;https://en.wikipedia.org/wiki/POSIX_Threads&quot;&gt;threads&lt;/a&gt;) and each one
will take care of communicating with one peer.&lt;/p&gt;

&lt;p&gt;The following pseudo-code shows a very common way to implement such a system: create a threads for
each request and let it handle one communication.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;send_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;wait_for_reply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;process_reply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NREQUESTS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;create_thread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NREQUESTS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;wait_for_thread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The execution diagram is as follow: the main thread creates one thread for each communication patterns
and wait that all of them finish their work. In that model, the operating system schedules the threads and activates them
when the data is available, adding more data structure into the kernel.&lt;/p&gt;

&lt;p&gt;One can note that after sending the request, a thread is waiting for the reply, doing nothing but waiting
for incoming communication.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/communication-threads.png&quot; alt=&quot;Communication with threads&quot; width=&quot;90%&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-asynchronous-world&quot;&gt;The asynchronous world&lt;/h2&gt;

&lt;p&gt;In the asynchronous world, the program &lt;strong&gt;post&lt;/strong&gt; operations and check the result later.
This communication model is similar to text messages: you send a text but does not wait for an immediate
return, the reply may arrive now or hours later. The key here: you do not have to stay on the line
and wait for a reply, you can check it later.&lt;/p&gt;

&lt;p&gt;Asynchronous communication are not sequential at all. In fact, you send
some information (text messages) and then, there is a main loop
that receives replies and write back according to a protocol.&lt;/p&gt;

&lt;p&gt;There is no need for additional task in that model, you can handle all
of them in the main task. The hard part is to follow the status of
each operation.&lt;/p&gt;

&lt;p&gt;The following pseudo-code shows a common approach to do asynchronuous
communication. The most important aspect of the main loop that handles
new events.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NTHREADS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;send_request&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

   &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

   &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NREQUESTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait_for_event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;process_event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;completed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The following diagram shows an execution trace of asynchronuous communication.
There is no new task, the main tasks posts all operations to do
in the beginning and check their status. Once all operations returned, the program
is complete. Note that replies are not coming back in a specific order.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/communication-nothread.png&quot; alt=&quot;Communication with threads&quot; width=&quot;90%&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;why-using-asynchronous-communications&quot;&gt;Why using asynchronous communications?&lt;/h1&gt;

&lt;p&gt;There are two majors issues with synchronous communication:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Lot of time of threads consists of waiting for I/O completion. It is a waste of resources&lt;/li&gt;
  &lt;li&gt;It introduces overhead, especially in the kernel for managing/scheduling/dispatching resources.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;By using asynchronuous communication, you just avoid resources waste and then, can
process more requests with the same hardware. If your system is massively distributed, 
and handles thousands of simultaneous connections it will
either (1) saves resources or (2) process more requests.&lt;/p&gt;

&lt;p&gt;If you are not convinced, I suggest watching
the video &lt;a href=&quot;https://www.youtube.com/watch?v=gaOa-Dsbb4o&quot;&gt;Scaling Server Software at Facebook&lt;/a&gt;, 
a simple 5% of memory or processor usage reduction means savings in the scale of thousands
or millions of dollars. There are more information about asynchronous communication 
use at facebook on &lt;a href=&quot;https://code.facebook.com/posts/1661982097368498&quot;&gt;their blog&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;To summarize, using synchronous programming is easily and straightforward
but does not scale for massively large, distributed system. Asynchronous
programming makes your progrma more complex but avoid bottlenecks and resources
overhead.&lt;/p&gt;

&lt;h1 id=&quot;comparing-sync-and-async-performance&quot;&gt;Comparing sync and async performance&lt;/h1&gt;

&lt;p&gt;In order to evaluate the performance difference between synchronous and asynchronous
communications, I wrote a small client program that starts N connections
to a server and print the result. Basically, the program initiates a fixed number (N) of HTTP connections
to a web server, get a page and prints it on the standard output. I wrote two variants of the program:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Synchronous&lt;/strong&gt;: each connection is using a thread that opens a socket, write the request and print the result. There are then N threads, N being the number of connections.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Asynchronous&lt;/strong&gt;: the main program opens N sockets and handle them in a main control loop.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In order to verify that each program retrieves the same thing (e.g. they return the same output), I log the output in a file and compares the file with diff.
Results were the same.&lt;/p&gt;

&lt;p&gt;I ran the tests on the following configuration&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Linux kernel 4.9&lt;/li&gt;
  &lt;li&gt;CPU Intel(R) Core(TM) i5-3320M CPU @ 2.60GHz&lt;/li&gt;
  &lt;li&gt;8GB RAM&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Finally, to remove the variability factor of the latency, all requests are issued to a local host.
I started by just running the program and vary the number of connections issued to see 
I then varied the number of concurrent connections between 1 and 100 and capture the system time used.
The system time is the time spent in kernel mode. It is clear that when using threads, there is an overhead
of resources management for the kernel.&lt;/p&gt;

&lt;p&gt;The following picture show the time spent in kernel mode for each version of the program (X=#connections and Y=time spent in kernel mode).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/async-evaluation-results.png&quot; alt=&quot;Time spent in kernel mode (X=#connections ; Y=time in kernel mode&quot; /&gt;&lt;/p&gt;

&lt;p&gt;These results are very limited - this is done on a single host that communicates with only another machine without additional load.
One can expect more impact when using threads, especially when using locks/mutexes with more load.&lt;/p&gt;

&lt;h1 id=&quot;a-note-on-posix-async&quot;&gt;A note on POSIX async&lt;/h1&gt;
&lt;p&gt;When starting this work, I was looking for &lt;a href=&quot;https://en.wikipedia.org/wiki/POSIX&quot;&gt;POSIX&lt;/a&gt; functions to perform async communications.
As POSIX is the reference for programming on UNIX system, this was natural to look how it handles
asynchronuous communications. Unfortunately, the asynchronuous API is a real disaster, in terms of its
definition (for example, it uses threads or signals to handle incoming data - something to just avoid)
or implementation (done in userland in Linux, which leads to poor performance).&lt;/p&gt;

&lt;p&gt;Other people &lt;a href=&quot;http://davmac.org/davpage/linux/async-io.html&quot;&gt;also reported&lt;/a&gt; also discusses this.
I have no idea why the current POSIX async API is so bad and why they published such a useless framework: the
notification mechanism (signals or threads) is inefficient, counter-productive and counter-intuitive.
I have no idea what the POSIX committee members were smoking the day they approved this.&lt;/p&gt;

&lt;p&gt;The result is that today, each UNIX has now its own implementation of asynchronous communication management
(&lt;a href=&quot;https://en.wikipedia.org/wiki/Epoll&quot;&gt;epoll for linux&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Kqueue&quot;&gt;kqueue for BSD&lt;/a&gt;
leaving developers with no option than developing non-portable code.&lt;/p&gt;

&lt;h1 id=&quot;where-you-go-from-there&quot;&gt;Where you go from there?&lt;/h1&gt;
&lt;p&gt;No question about it, asynchronous communications are definitively the way
to go if you are developing a massive distributed system.&lt;/p&gt;

&lt;p&gt;So how to use asynchronous communication effectively with your favorite programming language?
There are multiple frameworks available:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;For C++, &lt;a href=&quot;http://www.boost.org/&quot;&gt;boost&lt;/a&gt; includes asynchronous communication functions&lt;/li&gt;
  &lt;li&gt;For Python &amp;gt;3.4, the &lt;a href=&quot;https://docs.python.org/3/library/asyncio.html#module-asyncio&quot;&gt;asyncio&lt;/a&gt; framework
provides everything you need to manage asynchronous communication&lt;/li&gt;
  &lt;li&gt;For Python &amp;lt;3.4, you have existing framework as detailed in &lt;a href=&quot;https://thehackerguidetopython.com/&quot;&gt;The Hacker’s guide to Python&lt;/a&gt; - you can also learn more in this &lt;a href=&quot;https://www.youtube.com/watch?v=7sCu4gEjH5I&quot;&gt;youtube video&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;For pure C on linux, use directly &lt;a href=&quot;https://en.wikipedia.org/wiki/Epoll&quot;&gt;epoll&lt;/a&gt;. This is not portable to any other UNIX but I bet you might not migrate to any other system now.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Code used for evaluate sync/async performance is &lt;a href=&quot;https://github.com/juli1/async-study&quot;&gt;available online&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Sat, 15 Apr 2017 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/programming/linux/2017/04/15/comparison-sync-vs-async/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/programming/linux/2017/04/15/comparison-sync-vs-async/</guid>
        
        <category>epoll</category>
        
        <category>linux</category>
        
        <category>sync</category>
        
        <category>async</category>
        
        
        <category>programming</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>Goodbye CMU-SEI, welcome Amazon!</title>
        <description>&lt;p&gt;I was definitively not planning to move away from Pittsburgh but I am now
leaving the &lt;a href=&quot;http://sei.cmu.edu&quot;&gt;Carnegie Mellon Software Engineering Institute&lt;/a&gt; to join the &lt;a href=&quot;http://aws.amazon.com&quot;&gt;AWS&lt;/a&gt; team
in Seattle. In case you never heard of it, &lt;a href=&quot;http://aws.amazon.com&quot;&gt;Amazon Web Services&lt;/a&gt; is the leader 
of cloud-computing services and is used by many companies all over the world. You can read
more on &lt;a href=&quot;https://en.wikipedia.org/wiki/Amazon_Web_Services&quot;&gt;wikipedia there&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pittsburgh has been the city where my American journey started. It has been exciting to work at CMU-SEI and I 
met a lot of wonderful people in the city. I am really happy and excited to
start a new chapter.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Stay Hungry!&lt;/em&gt;&lt;/p&gt;

</description>
        <pubDate>Fri, 06 Jan 2017 05:13:20 -0800</pubDate>
        <link>http://julien.gunnm.org/geek/amazon/seattle/pittsburgh/2017/01/06/goodbye-cmu-sei-hello-amazon/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/geek/amazon/seattle/pittsburgh/2017/01/06/goodbye-cmu-sei-hello-amazon/</guid>
        
        <category>Amazon</category>
        
        <category>CMU-SEI</category>
        
        <category>Software Engineering Institute</category>
        
        
        <category>geek</category>
        
        <category>amazon</category>
        
        <category>Seattle</category>
        
        <category>Pittsburgh</category>
        
      </item>
    
      <item>
        <title>Flaskyelp, a simple yelp-like website with Python and Flask</title>
        <description>&lt;p&gt;This blog post details the design of a small yelp-like application in Python with Flask.&lt;/p&gt;

&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;
&lt;p&gt;Some years ago, while working at the &lt;a href=&quot;http://www.esa.int&quot;&gt;European Space Agency&lt;/a&gt;, I learned Python and decided to developed some code, mostly for the &lt;a href=&quot;http://taste.tuxfamily.org/&quot;&gt;TASTE project&lt;/a&gt;. Back then, I was pretty familiar with the language, the main thing was to get used to a strict indentation code, which took just few hours. Coding mostly in Java for the &lt;a href=&quot;https://github.com/osate/&quot;&gt;OSATE modeling platform&lt;/a&gt; since 2012, I decided to refresh my Python skills.&lt;/p&gt;

&lt;p&gt;The first idea I had then was to code a small website with Python. First, I read again &lt;a href=&quot;https://thehackerguidetopython.com/&quot;&gt;The Hacker’s Guide to Python&lt;/a&gt;, a book from an old friend, &lt;a href=&quot;https://julien.danjou.info/&quot;&gt;Julien Danjou&lt;/a&gt;, which contains a lot of hacks and tricks for Python.. The second action was to ask him what was a good active framework - as he was more familiar with the Python eco-system, he probably knows better what are the code framework to use. I would then be able to start right away my small website project. He recommended &lt;a href=&quot;http://flask.pocoo.org/&quot;&gt;Flask&lt;/a&gt;, a popular Python micro-framework.&lt;/p&gt;

&lt;h1 id=&quot;introducing-flaskyelp-a-small-yelp-in-python&quot;&gt;Introducing Flaskyelp, a small yelp in Python&lt;/h1&gt;
&lt;p&gt;I decided to code a small &lt;a href=&quot;http://yelp.com&quot;&gt;Yelp&lt;/a&gt;-clone. Nothing fancy, it will be very simple to design: a basic Flask application, no CSS or fancy front-end, no complex model or interaction with &lt;a href=&quot;https://github.com/osate/&quot;&gt;SQLAlchemy&lt;/a&gt;, just a minimalistic design and a sqlite database. The emphasis was to refresh my python skills and be familiar again with the environment (build system, testing infrastructure, etc.)!&lt;/p&gt;

&lt;p&gt;Also, I wanted to share it so that people in a similar situation can get the sources and potentially learn from it. I put the sources &lt;a href=&quot;https://github.com/juli1/flaskyelp&quot;&gt;on github&lt;/a&gt;, which can help you in case you want to start using Flask. It is in fact very easy to use and install. I will go through the basic steps.&lt;/p&gt;

&lt;h2 id=&quot;install&quot;&gt;Install&lt;/h2&gt;
&lt;p&gt;You need a working python environment. The tool depend on &lt;a href=&quot;http://flask.pocoo.org/&quot;&gt;Flask&lt;/a&gt;, so, you need to install it. Otherwise, you can use a virtual environment to install all the dependencies. There is the set of commands that would get you started:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/juli1/flaskyelp.git
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;flaskyelp
virtualenv venv
. ./venv/bin/activate
pip install flask
python -m flask initdb
python -m flask run
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;During this sequence of commands, you checkout the project, install the virtual environment, activate it, install the dependency, initialize the database and run the program.&lt;/p&gt;

&lt;p&gt;Once the program is running, you can see the result in a browser by going on &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:5000/&lt;/code&gt;. You should have something similar as below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/flaskyelp.png&quot; alt=&quot;flaskyelp&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;test-it&quot;&gt;Test it!&lt;/h2&gt;

&lt;p&gt;I always try to implement test cases for my code, it is essential to make sure you do not break any functionality when you are modifying your code or even trying to implement a new feature! That’s why I wrote some tests to check that the system is behaving as expected! I did not implement a full test-suite but simple test case that checks basic behavior.&lt;/p&gt;

&lt;p&gt;In order to test the application, you can run &lt;code class=&quot;highlighter-rouge&quot;&gt;python setup.py test&lt;/code&gt; to run them.&lt;/p&gt;

&lt;p&gt;You should expect a trace like this.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;....
Using /home/julien/git/flaskyelp/.eggs/py-1.4.31-py2.7.egg
running egg_info
writing requirements to flaskyelp.egg-info/requires.txt
writing flaskyelp.egg-info/PKG-INFO
writing top-level names to flaskyelp.egg-info/top_level.txt
writing dependency_links to flaskyelp.egg-info/dependency_links.txt
reading manifest file &lt;span class=&quot;s1&quot;&gt;'flaskyelp.egg-info/SOURCES.txt'&lt;/span&gt;
reading manifest template &lt;span class=&quot;s1&quot;&gt;'MANIFEST.in'&lt;/span&gt;
writing manifest file &lt;span class=&quot;s1&quot;&gt;'flaskyelp.egg-info/SOURCES.txt'&lt;/span&gt;
running build_ext
&lt;span class=&quot;o&quot;&gt;=======================================================&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;session starts &lt;span class=&quot;o&quot;&gt;=======================================================&lt;/span&gt;
platform linux2 -- Python 2.7.12+, pytest-3.0.3, py-1.4.31, pluggy-0.4.0
rootdir: /home/julien/git/flaskyelp, inifile:
collected 7 items

tests/test_flaskyelp.py .......

&lt;span class=&quot;o&quot;&gt;====================================================&lt;/span&gt; 7 passed &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.22 seconds &lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;julien@akira]/home/julien/git/flaskyelp#
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h1&gt;

&lt;p&gt;I really enjoy learning Python. The language is well-documented, which makes it easier to learn and use. The next project is to implement a bot for the &lt;a href=&quot;http://www.slack.com&quot;&gt;slack collaboration platform&lt;/a&gt;. I expect to be done during the next two weeks. As usual, I will post the code there.&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/juli1/flaskyelp&quot;&gt;Flaskyelp on github&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://flask.pocoo.org/&quot;&gt;Flask&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://thehackerguidetopython.com/&quot;&gt;The Hacker’s Guide to Python&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sat, 01 Oct 2016 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/geek/python/2016/10/01/flaskyelp-a-small-yelp-in-flask-with-python/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/geek/python/2016/10/01/flaskyelp-a-small-yelp-in-flask-with-python/</guid>
        
        <category>Python</category>
        
        <category>Flask</category>
        
        <category>Yelp</category>
        
        
        <category>geek</category>
        
        <category>python</category>
        
      </item>
    
      <item>
        <title>Simplify your OSATE and AADL analysis code with Java 8 lambda</title>
        <description>&lt;p&gt;If you already wrote analysis code inside &lt;a href=&quot;http://www.osate.org&quot;&gt;OSATE&lt;/a&gt;, you probably know that when writing an analysis plug-in, filtering components (according to their type, property, etc) can be painful. It can introduce a lot of useless code that browse the model to find the component of interest. The code used to browse the model is long and add a lot of &lt;strong&gt;noise&lt;/strong&gt;, making the review difficult.&lt;/p&gt;

&lt;p&gt;Over the last months, I started to use the &lt;a href=&quot;http://www.eclipse.org/xtend/&quot;&gt;xtend&lt;/a&gt; language for writing my analysis plugin. It was a way to simplify my code and learn a new language. When I started to read about Java 8, I was excited to use the &lt;a href=&quot;https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html&quot;&gt;lambda expression mechanism&lt;/a&gt;. And realized that it can be leveraged to simplify the design of my AADL plugins.&lt;/p&gt;

&lt;p&gt;Bottom line: it remove a lot of &lt;strong&gt;noisy&lt;/strong&gt; code to only focus on what is really important. It makes the code more understandable and easy to read.&lt;/p&gt;

&lt;p&gt;I will illustrate that with an example. In this example, I get all data components that have the &lt;code class=&quot;highlighter-rouge&quot;&gt;Data_Size&lt;/code&gt; property set to 0. The difference between a standard, recursive implementation and the lambda-expression is simple: about 20 lines of code vs 3 lines of code.&lt;/p&gt;

&lt;p&gt;The imperative version looks like this (see below): you have to browse the component hierarchy and check the component category and &lt;code class=&quot;highlighter-rouge&quot;&gt;Data_Size&lt;/code&gt; value. Really, what you care in this code is the condition that filter the component. All the rest is noise, not useful but can still introduce a lot of bugs.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findComponentRecursive&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;si&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;si&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getComponentInstances&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCategory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ComponentCategory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetProperties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDataSizeInBytes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addAll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findComponentRecursive&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findComponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SystemInstance&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;si&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findComponentRecursive&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;si&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s now have a look at the same implementation but with the lambda expression. What you really have is a method that filters the components using a predicate. Simple. Easy to read. Efficient.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findComponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SystemInstance&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;si&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;si&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAllComponentInstances&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCategory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ComponentCategory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetProperties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDataSizeInBytes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Collectors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;I am still reading code examples about Java 8 and using lambda. I am convinced it can help a lot to write better code, increase productivity and reduce bugs. If you are writing analysis plugins for AADL, I would definitively recommend to at list &lt;a href=&quot;https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html&quot;&gt;have a look at the tutorial&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Sun, 31 Jul 2016 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/geek/osate/aadl/2016/07/31/java-lambda-osate-plugins/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/geek/osate/aadl/2016/07/31/java-lambda-osate-plugins/</guid>
        
        <category>AADL</category>
        
        <category>OSATE</category>
        
        <category>java lambda</category>
        
        
        <category>geek</category>
        
        <category>osate</category>
        
        <category>aadl</category>
        
      </item>
    
      <item>
        <title>Supporting the UART1 of the BeagleBone Black with seL4/CAmkES</title>
        <description>&lt;h1 id=&quot;in-a-nutshell&quot;&gt;In a nutshell&lt;/h1&gt;

&lt;p&gt;In this article, I explain how to support UART1 of the &lt;a href=&quot;http://beagleboard.org/black&quot;&gt;Beaglebone Black&lt;/a&gt; with seL4 and the CAmkES component approach. I explain how to test the UART1, build a cable, patch the kernel and make your application.&lt;/p&gt;

&lt;h1 id=&quot;building-your-cable&quot;&gt;Building your cable&lt;/h1&gt;

&lt;p&gt;First, you need a cable to connect to the UART1. I (well, the folks at work helped me to get one!) used &lt;a href=&quot;https://www.adafruit.com/products/954&quot;&gt;this USB to TTL serial cable from Adafruit&lt;/a&gt;, which worked fine. The white PIN is connected to PIN 24 on the P9 connector board and the green cable is connected to PIN 26 on the P9 connector board.&lt;/p&gt;

&lt;p&gt;The picture is ugly but this is how it looks like.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/beaglebone-uart1.jpg&quot; alt=&quot;Beaglebone with UART1 cable&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;testing-the-uart1-interface-with-debian&quot;&gt;Testing the UART1 interface with Debian&lt;/h1&gt;

&lt;p&gt;You can use the UART1 interface with the pre-installed debian on the Beaglebone. It already supports UART1 operation. What you need to do is to build a cable, connect on the debian and send some stuff on the port.&lt;/p&gt;

&lt;p&gt;The Beaglebone supports what we call a Device Tree Overlay. Long story short, this is a way to change the usage of each PIN. You then have to use the appropriate overlay to use the UART1. The default settings do not work, and you have to issue the following command to enable UART1.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;echo ADAFRUIT-UART1 &amp;gt; /sys/devices/bone_capemgr.*/slots
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then, you can connect on the serial and issue whatever you want. Let’s say the UART1 of the Beaglebone Black is connected to /dev/ttyUSB1, you can then connected on screen and type anything.&lt;/p&gt;

&lt;p&gt;On your computer, run the following command:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;screen  /dev/ttyO1 115200
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On the Beaglebone Black, run the following command:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;screen /dev/ttyUSB1 115200
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Type stuff on both screen, you should see what is sent/received.&lt;/p&gt;

&lt;p&gt;If it does not work, check your cables and/or the commands you invoked. Let’s move on.&lt;/p&gt;

&lt;h1 id=&quot;implementing-the-kernel-side&quot;&gt;Implementing the kernel side&lt;/h1&gt;

&lt;p&gt;First, checkout the seL4 and CAmkES repository. When you import the kernel, some stuff are not supported. For example, the UART1 is not declared. You then need to add the definition of UART1 in the kernel.&lt;/p&gt;

&lt;p&gt;Edit the file &lt;em&gt;kernel/include/plat/am335x/plat/machine/devices.h&lt;/em&gt; and add the following line.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#define UART1_PADDR     0x48022000
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then, in &lt;em&gt;kernel/src/plat/am335x/machine/hardware.c&lt;/em&gt; you need to add the support for all UARTs. I found &lt;a href=&quot;https://e2e.ti.com/support/embedded/starterware/f/790/t/214547&quot;&gt;online a nice piece of code&lt;/a&gt; that configures all UARTs. I imported it directly into the kernel. You can see the code in &lt;a href=&quot;/assets/sel4-kernel-uart1bb.diff&quot;&gt;my patch&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;implementing-the-component&quot;&gt;Implementing the component&lt;/h1&gt;

&lt;p&gt;So now, the kernel has the information about the UART1 device (&lt;em&gt;UART1_PADDR&lt;/em&gt;) and activate the necessary resources to handle it. Now, we need to describe the component using CAmkES and implement its driver in the user-space partition.&lt;/p&gt;

&lt;h2 id=&quot;camkes-definition&quot;&gt;CAmkES definition&lt;/h2&gt;

&lt;p&gt;We define a hardware CAmkES component that represents the UART component and we connect it to the device that is supposed to handle/manage it.&lt;/p&gt;

&lt;p&gt;My assembly look like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import &amp;lt;std_connector.camkes&amp;gt;;
import &quot;components/timer/Timer.camkes&quot;;
import &quot;components/ProducerThreadImpl/ProducerThreadImpl.camkes&quot;;
import &quot;components/ConsumerThreadImpl/ConsumerThreadImpl.camkes&quot;;

component UART{
  hardware;
  dataport Buf mem;
}

component ConsumerThreadImpl
{
  include &quot;generatedtypes.h&quot;;
  control;
  dataport simpletype data_sink;
  consumes sig activator;
  dataport Buf uartmem;
}

assembly
{
  composition
  {
    component Timerbase timerbase;
    component Timer timer;
    component UART drv;

    component ProducerThreadImpl Prod_Pinger;
    component ConsumerThreadImpl Cons_PingMe;

    connection seL4SharedData connection0(from Prod_Pinger.data_source, to Cons_PingMe.data_sink);
    connection seL4Notification notification0 (from timer.Prod_Pinger_activator, to Prod_Pinger.activator);
    connection seL4Notification notification1 (from timer.Cons_PingMe_activator, to Cons_PingMe.activator);
    connection seL4HardwareMMIO uart_mem (from Cons_PingMe.uartmem, to drv.mem);
    connection seL4HardwareMMIO timer_mem (from timer.reg, to timerbase.reg);
    connection seL4HardwareInterrupt timer_irq (from timerbase.irq, to timer.irq);
   }

  configuration
  {
    connection0.from_access = &quot;W&quot;;
    connection0.to_access = &quot;R&quot;;
    timerbase.reg_attributes = &quot;0x48040000:0x1000&quot;;
    timerbase.irq_attributes = 68;
    drv.mem_attributes       = &quot;0x48022000:0x1000&quot;;
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In this declaration, the assembly has two interesting component:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;UART&lt;/strong&gt; (and its related instance &lt;em&gt;drv&lt;/em&gt;) represents the hardware component of the UART. We configure it in the configuration section and its memory area (see &lt;em&gt;drv.mem_attributes = 0x48022000:0x1000&lt;/em&gt;). This will then map the address &lt;em&gt;0x48022000&lt;/em&gt; into the partition in a pointer called uartmem.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ConsumerThreadImpl&lt;/strong&gt; represents the component that is using the hardware component. This component will then contain all the code necessary to execute the driver.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There are other artifacts of course, such as the timer and timerbase components that are here to handle the timer and activate periodic tasks. I detailed these aspects before, you can read &lt;a href=&quot;/geek/sel4/2016/04/18/periodic-tasks-with-sel4/&quot;&gt;this post in case you are interested&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The architecture of our CAmkES application is as follow: the producer will send a number that is eventually send through the UART by the Consumer component.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/sel4-bb-uart1.png&quot; alt=&quot;CAmkES architecture&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;implementing-the-driver&quot;&gt;Implementing the driver&lt;/h2&gt;

&lt;p&gt;Now, we need to implement the driver. As for the kernel, I used a lot of code from &lt;a href=&quot;https://e2e.ti.com/support/embedded/starterware/f/790/t/214547&quot;&gt;this post on the starterware forum&lt;/a&gt;. Mostly, the code first initialize the UART1 and send the string “hello” followed by the number received (module 10).&lt;/p&gt;

&lt;p&gt;The code of the component looks like this:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;int run(void)
{
        devmem = (unsigned int) uartmem;
        unsigned int UARTparms = 0;
        char mybuf[10];
        int val;

        memset (mybuf, 0, 10);
        UartFIFOConfigure(devmem);
        UARTparms = 0x3; // p4033 - 8 data bits, 1 stop bit, no parity
        UARTsetup(devmem, 115200, UARTparms, UART16x_OPER_MODE);

        while (1)
        {

                activator_wait();
                user_ping_spg ((*data_sink) );
                sprintf(mybuf, &quot;hello %d\n&quot;, (*data_sink % 10));
                UART_tx(devmem, mybuf, 7);
                UART_tx(devmem, &quot;hello&quot;, 5);
                printf (&quot;UART= %d\n&quot;, val);

        }
        return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We imported some code to initialize and use UART1. The CAmkES code generator mapped the 0x48022000 address (defines in the CAmkES description for the hardware component) in the uartmem component. We assigned the address of the &lt;em&gt;uartmem&lt;/em&gt; variable into &lt;em&gt;devmem&lt;/em&gt;. We can then manipulate the device using this address.&lt;/p&gt;

&lt;p&gt;The code of other functions (&lt;em&gt;UArtFIFOConfigure&lt;/em&gt; and &lt;em&gt;UARTsetup&lt;/em&gt;) are included in the &lt;a href=&quot;(/assets/pingbeagleboneinstance-uart1.tgz)&quot;&gt;zip file containing the full CAmkES application&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;booting-the-application&quot;&gt;Booting the application&lt;/h1&gt;

&lt;p&gt;Once you compiled the application, you need to boot it! If you do not know how to compile or produce binary files for a CAmkES application that targets the Beaglebone Black, you can read the &lt;a href=&quot;http://sel4.systems/Info/CAmkES/GettingStarted.pml&quot;&gt;CAmkES documentation&lt;/a&gt; and the seL4 documentation about the &lt;a href=&quot;https://sel4.systems/Info/Hardware/Beaglebone/&quot;&gt;Beaglebone&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The beaglebone uses something weird called the Device Tree Overlay. You can get &lt;a href=&quot;https://learn.adafruit.com/introduction-to-the-beaglebone-black-device-tree/device-tree-overlays&quot;&gt;information there&lt;/a&gt;. Long story short, this mechanism lets you configure how the PIN of the boards are connected to the AM335x SOC.&lt;/p&gt;

&lt;p&gt;We do not need to change everything but still need to activate the UART1. You can do this when booting the board with u-boot. Type the following lines in u-boot:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mw.l 0x44E10980 0x30
mw.l 0x44E10984 0x00
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This would be enough. It seems it cannot work in the component itself. On the other hand, as discussed in &lt;a href=&quot;http://sel4.systems/pipermail/devel/2016-June/000854.html&quot;&gt;this post&lt;/a&gt; it seems you can avoid that by inserting the following line in &lt;em&gt;platform_init()&lt;/em&gt;.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*(volatile uint32_t*)0x44E10980 = 0x30;
*(volatile uint32_t*)0x44E10984 = 0x00;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then, time to load the binary. I used a network connection to do that.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dhcp ${loadaddr} 192.168.1.1:sel4.img

go ${loadaddr}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then, just issue a &lt;em&gt;cat /dev/ttyUSB1&lt;/em&gt; and &lt;em&gt;voila!&lt;/em&gt;. The following picture show what I received from the UART1 of the BeagleBone Black.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/sel4-bb-term.png&quot; alt=&quot;Output from UART1&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;debugging&quot;&gt;Debugging&lt;/h1&gt;

&lt;p&gt;Sometimes, you need to debug and trace when things are going wrong. You might experience this. I would recommend the &lt;a href=&quot;https://github.com/SEL4PROJ/sel4-tutorials/blob/master/docs/seL4Tutorial.pdf&quot;&gt;seL4 tutorial&lt;/a&gt; that provides some useful direction. When having an exception in a partition, the following command is very useful.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;arm-none-eabi-objdump -dS /path/to/your/binary | less
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In a nutshell, it gives you the assembly code, its address and with the associated C line. So, you can exactly know where to look for when you get the address related to a crash.&lt;/p&gt;

&lt;p&gt;For example, when debugging the UART1 driver in the partition, I used this command a lot. Very useful. You might need it!&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;arm-none-eabi-objdump -dS build/arm/am335x/pingbeagleboneinstance/Cons_PingMe.instance.bin | less
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;special-thanks&quot;&gt;Special thanks&lt;/h1&gt;

&lt;p&gt;The staff that are working on this project at CMU as well as the seL4 community!&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Patch for the kernel: &lt;a href=&quot;/assets/sel4-kernel-uart1bb.diff&quot;&gt;available here&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;CAmkES application with the driver: &lt;a href=&quot;/assets/pingbeagleboneinstance-uart1.tgz&quot;&gt;available here&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Bare code for UART1 support: &lt;a href=&quot;https://e2e.ti.com/support/embedded/starterware/f/790/t/214547&quot;&gt;discussion on TI forums&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://sel4.systems/pipermail/devel/2016-June/000849.html&quot;&gt;Related thread on the seL4 mailing list&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 15 Jun 2016 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/geek/sel4/beaglebone%20black/2016/06/15/beaglebone-black-sel4-uart1/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/geek/sel4/beaglebone%20black/2016/06/15/beaglebone-black-sel4-uart1/</guid>
        
        <category>sel4</category>
        
        <category>real-time</category>
        
        <category>CAmkES</category>
        
        
        <category>geek</category>
        
        <category>sel4</category>
        
        <category>beaglebone black</category>
        
      </item>
    
      <item>
        <title>Swissvale activity guide</title>
        <description>&lt;p&gt;I have been a resident of &lt;a href=&quot;http://www.swissvale.org&quot;&gt;Swissvale&lt;/a&gt; for more than 2 years now and I think I have a good idea about where to go if you want to be outside. I might miss some details and you are welcome to send errata or just some information to complete this guide.&lt;/p&gt;

&lt;p&gt;The following map is a general map of Swissvale with many points of interests. It includes several places for outdoor and indoor activities.
Also, a good source of information about swissvale can be found on the
&lt;a href=&quot;http://www.swissvale.org&quot;&gt;swissvale community website&lt;/a&gt;.&lt;/p&gt;

&lt;center&gt;
&lt;iframe src=&quot;https://www.google.com/maps/d/embed?mid=1H6IwVhrsjCAR9kjU4aMMfAMKr7w&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;&lt;/iframe&gt;
&lt;/center&gt;

&lt;h1 id=&quot;general-points-of-interests&quot;&gt;General points of interests&lt;/h1&gt;

&lt;h2 id=&quot;frick-park&quot;&gt;Frick Park&lt;/h2&gt;

&lt;p&gt;The Frick Park has a lot to offer for almost everybody. You can walk, run, bike, have a picnic, let’s your kids play on the playground or let your dog exercise in off-leash areas. Located very close to Swissvale, you can just walk/jog/bike there or even park.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;http://wpoc.org/&quot;&gt;Western Pennsylvanian Orienteering Club&lt;/a&gt; has made a map of Frick Park. You can &lt;a href=&quot;http://wpoc.org/FrickTrailx.pdf&quot;&gt;find it there&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/frick-park-map.png&quot; alt=&quot;frick-park-map&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wpoc.org/FrickTrailx.pdf&quot;&gt;Topographic map of Frick Park&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;going-to-downtown-by-bike&quot;&gt;Going to downtown by bike&lt;/h2&gt;

&lt;p&gt;From Swissvale, you can go downtown with your bike very easily and using almost only bike lanes. This is about 10 miles, which can be between 30 minutes and one hour, depending your fitness level. The route pass by the south side and along the Monongahela river, which is very pleasant.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056058237&quot;&gt;You can check out the map on mapmyrun&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;connection-to-the-gap&quot;&gt;Connection to the GAP&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&quot;https://gaptrail.org/&quot;&gt;GAP&lt;/a&gt; lets you do a full 335 miles bike ride from Pittsburgh, PA to Washington D.C. You can easily go on the &lt;a href=&quot;https://gaptrail.org/&quot;&gt;GAP course&lt;/a&gt; from Swissvale, the route pass by Homestead. All it takes it about 2 to 3 miles.&lt;/p&gt;

&lt;p&gt;You can check out &lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056058821&quot;&gt;the map to connect to the GAP from Swissvale on mapmyrun&lt;/a&gt;. An alternative if you do not want to use commercial st. and the trail: use the Rankin bridge, which has a bike lane. You can then connect to the GAP.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/on-the-gap.jpg&quot; alt=&quot;on-the-gap&quot; /&gt;&lt;/p&gt;

&lt;p&gt;View while riding on the Great Allegheny Passage&lt;/p&gt;

&lt;h1 id=&quot;running-and-biking&quot;&gt;Running and Biking&lt;/h1&gt;

&lt;h2 id=&quot;general-tips&quot;&gt;General tips&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Do not use South Braddock Avenue, use East-End Avenue instead. You will avoid the pollution and heavy traffic.&lt;/li&gt;
  &lt;li&gt;During winter, be very careful of potential icy spots in Frick.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;going-to-frick&quot;&gt;Going to Frick&lt;/h2&gt;

&lt;p&gt;There are many options to go to Frick. If you go by running/biking/walking, the options are the following:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Go down commercial st and turn right at the bottom of commercial (location of Entrance Frick 1 on the map)&lt;/li&gt;
  &lt;li&gt;Use South Braddock and use the Park entrance at the CLASS building (location of Entrance Frick 2 on the map)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you are driving your car, you can park around the park, either at the bottom of commercial, close to the CLASS building or close to the tennis court. The map has some dedicated places to indicate where you can park.&lt;/p&gt;

&lt;p&gt;There is two maps available if you want to train in Frick: a &lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056062605&quot;&gt;10 miles option that go through Frick and Schenley&lt;/a&gt; and a easy 4 miles loop only in Frick&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/frick-park-winter.jpg&quot; alt=&quot;frick-park-winter&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Frick Park during Winter&lt;/p&gt;

&lt;h2 id=&quot;fast-5-miles-around-swissvalewilkinsburghedgewood&quot;&gt;Fast 5 miles around Swissvale/Wilkinsburgh/Edgewood&lt;/h2&gt;

&lt;p&gt;There is a good loop around Swissvale/Edgewood/Wilkinsburg that I do regularly and is fantastic if you train for a road race. This is a 5 miles loop that you can extend depending your training needs (you can extend by going in Squirrel Hill through Forbes for example).&lt;/p&gt;

&lt;p&gt;This route does not has much hills so you can have an idea of your pace on a road race, such as a marathon. This is the route I am using when I want to do a speed test for a 10K, a half marathon or a flat marathon such as Pittsburgh. &lt;a href=&quot;http://www.mapmyrun.com/routes/view/1057012411&quot;&gt;Check out the map there!&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;route-suggestions&quot;&gt;Route Suggestions&lt;/h2&gt;
&lt;p&gt;The following routes are there to give you some ideas for commuting by bike or running. The goal is not to take the shortest route but the one that is short and try to avoid cars and traffic. It is a good compromise to commute without having potential hazards or issues.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056063795&quot;&gt;Swissvale to Shadyside&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056064393&quot;&gt;Swissvale to Carnegie Mellon University&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056064787&quot;&gt;Swissvale to the East-End Food Coop&lt;/a&gt;: no need to use your car anymore to get your groceries!&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056062605&quot;&gt;Run around Frick and Schenley Park&lt;/a&gt;: 10 miles with a good elevation, this is perfect if you want to prepare a marathon or even a more challenging event (i.e. ironman, ultra-marathon)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056058821&quot;&gt;Swissvale to the GAP&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.mapmyrun.com/routes/view/1056058237&quot;&gt;Swissvale to Point State Park&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;walking&quot;&gt;Walking&lt;/h1&gt;

&lt;p&gt;Frick is probably the best place for a walk around. Unfortunately, getting there might take some time and the route to go to the park is not so nice. check out the map to see where you can park. Otherwise, you can still go and walk around Swissvale and go to different parks. The children playground in Swisselm is great when you have some sun.&lt;/p&gt;

&lt;h1 id=&quot;playground&quot;&gt;Playground&lt;/h1&gt;

&lt;h2 id=&quot;swisselm-playground&quot;&gt;Swisselm Playground&lt;/h2&gt;

&lt;p&gt;The Swisselm playground is a great location close to Swissvale. You can also go there by walking or biking (assuming your kid(s) can bike).&lt;/p&gt;

&lt;h2 id=&quot;frick-park-playground&quot;&gt;Frick Park Playground&lt;/h2&gt;

&lt;p&gt;There is also a playground in Frick Park at the entrance on Beechwood Boulevard. Unfortunately, this is not so easy to access it if you are walking and would require to drive. However, there is plenty of parking around.&lt;/p&gt;

&lt;h1 id=&quot;dog-parks&quot;&gt;Dog Parks&lt;/h1&gt;

&lt;p&gt;Frick Park has two dog parks:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Located in the lower part of Frick Park, this is easily accessible if you park close to the tennis court (entrance 3 on the map)&lt;/li&gt;
  &lt;li&gt;Located in the upper part of Frick Park, it is better to use the entrance on Beechwood boulevard to find it.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;bike-friendly-businesses&quot;&gt;Bike-friendly businesses&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.biddlesescape.com/&quot;&gt;Biddle’s Escape&lt;/a&gt;: this local coffee shop has a bike rack in front of the store. Well located close to Frick Park, this is a fantastic place to have a cup of coffee with a friend or stay to work.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.eastendfood.coop/&quot;&gt;East-End Food Coop&lt;/a&gt;: close to Swissvale ( to 3 miles), it has some bike racks available next to the parking lot. Bonus, we have a map that shows how to get there safely by avoiding South Braddock.&lt;/li&gt;
  &lt;li&gt;Bike racks close to D’s: in the Regent Square area, there are some bike racks close to D’s. Convenient if you want to shop in the area but definitively not as cool as the one from Biddle’s Escape.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;events-around-swissvale&quot;&gt;Events around Swissvale&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.theswissvalemile.com/&quot;&gt;The Swissvale Mile&lt;/a&gt;: a one mile race in the Swissvale community. The race is an opportunity to gather everybody: runner, walker, dog lovers, kids. Consider going there and supporting your community!&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.gprrc.com&quot;&gt;The Gut Buster&lt;/a&gt;: organized by the Greater Pittsburgh Road Runner Club (GPRRC), the Gut Buster takes place on Thanksgiving day in the morning. There is a 4 and 8 miles options. The race is ridiculously cheap (around $5 I guess) and very friendly. It starts in Frick Park and go through the biggest hills. After the race, you can take another piece of cake without any guilt. You can check out the course (8 miles) on &lt;a href=&quot;https://www.strava.com/activities/439779090&quot;&gt;strava&lt;/a&gt; or &lt;a href=&quot;http://www.mapmyrun.com/workout/1261766983&quot;&gt;mapmyrun&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;www.thepittsburghmarathon.com&quot;&gt;The Pittsburgh Marathon&lt;/a&gt;: the official marathon that goes all over the city.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://pedalpgh.org/&quot;&gt;Pedal PGH&lt;/a&gt;: a ride along the city with several distances that accommodates all riders and bikers. Fantastic way to discover Pittsburgh and many places you probably do not know about.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;communities-and-social-media&quot;&gt;Communities and Social Media&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://bikepgh.org/&quot;&gt;Bike Pittsburgh&lt;/a&gt;: THE non-profit to join is you like biking in Pittsburgh. They have a fantastic bike map available on their website. Thanks to them, Pittsburgh has more bike lanes since the last years.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://steelcityrrc.org/&quot;&gt;Steel City Road Runners&lt;/a&gt;: probably the biggest running club in Pittsburgh. Supported by the Pittsburgh marathon office, it offers multiple runs every week in different locations across the city.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.facebook.com/groups/FrickParkTrailRunners/&quot;&gt;Frick Park Trail Runners on facebook&lt;/a&gt;: group to organize runs in Frick Park&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;maps&quot;&gt;Maps&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://wpoc.org/FrickTrailx.pdf&quot;&gt;Frick Park Topographic Map&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;suggestions&quot;&gt;Suggestions?&lt;/h1&gt;
&lt;p&gt;If you have any question or suggestion to improve this, please &lt;a href=&quot;/about&quot;&gt;contact me&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Thu, 12 May 2016 00:00:00 -0700</pubDate>
        <link>http://julien.gunnm.org/swissvale-active/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/swissvale-active/</guid>
        
        <category>swissvale</category>
        
        <category>biking</category>
        
        <category>running</category>
        
        <category>walking</category>
        
        <category>children</category>
        
        <category>playground</category>
        
        
        <category>swissvale</category>
        
      </item>
    
      <item>
        <title>Periodic tasks with seL4</title>
        <description>&lt;h1 id=&quot;in-a-nutshell&quot;&gt;In a nutshell&lt;/h1&gt;

&lt;p&gt;In this article, I explain how to implement periodic tasks in seL4, a design pattern used in many embedded, safety-critical systems. This sounds probably very basic but using periodic tasks with non-blocking communication mechanisms is really helpful to ensure that your system will continue to work and meet its deadline. Please not that it does not mean that it works correctly, it just guarantees some important timing and behavioral characteristics.&lt;/p&gt;

&lt;h1 id=&quot;context&quot;&gt;Context&lt;/h1&gt;

&lt;p&gt;I started using the &lt;a href=&quot;http://sel4.systems/&quot;&gt;seL4 micro-kernel&lt;/a&gt; since few months. For those who do not know what is seL4, this is a formally verified kernel. Formally verified means that seL4 services are &lt;em&gt;correctly&lt;/em&gt; implemented. It does not mean that the services are &lt;em&gt;correctly&lt;/em&gt; configured and used, which is another story (more on that in a further article).&lt;/p&gt;

&lt;p&gt;The micro-kernel itself provides only very few services, mostly: &lt;abbr title=&quot;Thread Control Block&quot;&gt;TCB&lt;/abbr&gt;, endpoints and other communications services. Nothing more, especially time or scheduling. Device drivers are also implemented in user-space, meaning that partitions must require access to the hardware and manage it appropriately.&lt;/p&gt;

&lt;p&gt;Also, writing code for seL4 is hard. Really hard. You have not only to understand the services but also use the API and do the right function calls with the appropriate arguments. Trust me, it is a real pain. In order to overcome these issues, the NICTA team developed a specific &lt;abbr title=&quot;Architecture Description Language&quot;&gt;ADL&lt;/abbr&gt;, &lt;a href=&quot;https://wiki.sel4.systems/CAmkES&quot;&gt;CAmkES&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;issue-with-sel4-and-periodic-tasks&quot;&gt;Issue with seL4 and periodic tasks&lt;/h1&gt;

&lt;p&gt;As mentioned before, seL4 does not provide any timing service. It provides a service to schedule threads (using a Round-Robin policy with priorities) but does not provide anything to wait or be activated at a given period.&lt;/p&gt;

&lt;p&gt;So, if you are looking for something like &lt;code class=&quot;highlighter-rouge&quot;&gt;pthread_cond_timedwait()&lt;/code&gt; or just &lt;code class=&quot;highlighter-rouge&quot;&gt;sleep()&lt;/code&gt; (which is &lt;strong&gt;NOT&lt;/strong&gt; real-time friendly by the way), you will feel out of luck.&lt;/p&gt;

&lt;p&gt;To overcome this issue, you must design your own timing service in a process that will ultimately activate the other tasks.&lt;/p&gt;

&lt;h1 id=&quot;implement-a-timing-service&quot;&gt;Implement a timing service&lt;/h1&gt;

&lt;p&gt;We will implement a timing service with CAmkES. The timing service will define a hardware component (hardware timer) and a time manager that will activate the tasks according to their periods.&lt;/p&gt;

&lt;p&gt;In the following example, we will have two periodic tasks: one is activated every second while the other one is activated every two seconds. We will then define four components:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;The hardware component that abstracts the hardware platform&lt;/li&gt;
  &lt;li&gt;The time manager that manages the hardware components and send a signal to activate the other tasks. One signal will be sent every second, another every two seconds&lt;/li&gt;
  &lt;li&gt;One task connected to the first signal (activated every second)&lt;/li&gt;
  &lt;li&gt;One task connected to the second signal (activated every two seconds)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;We will illustrate that with the x86 platform.&lt;/p&gt;

&lt;h2 id=&quot;defining-the-camkes-components&quot;&gt;Defining the CAmkES components&lt;/h2&gt;

&lt;p&gt;The overall architecture is defined below. The CAmkES hardware component models your time, what will give you the concept of time. On the x86 architecture, there is the old &lt;a href=&quot;http://wiki.osdev.org/Programmable_Interval_Timer&quot;&gt;&lt;abbr title=&quot;Programmable Interval Interrupt&quot;&gt;PIT&lt;/abbr&gt;&lt;/a&gt; that provides the concept of time. We will use it then. For more information about how it works, you can read the description on &lt;a href=&quot;http://wiki.osdev.org/Programmable_Interval_Timer&quot;&gt;osdev&lt;/a&gt; or &lt;a href=&quot;https://en.wikibooks.org/wiki/X86_Assembly/Programmable_Interval_Timer&quot;&gt;wikibooks&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/sel4-timer-architecture.png&quot; alt=&quot;architecture&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The timer components and timer managment in CAmkES are defining like the following (&lt;code class=&quot;highlighter-rouge&quot;&gt;Timerbase&lt;/code&gt; being the hardware component and &lt;code class=&quot;highlighter-rouge&quot;&gt;Timer&lt;/code&gt; the time manager)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;component Timerbase {
   hardware;
   provides IOPort command;
   provides IOPort channel0;
   emits PITIRQ irq;
}

component Timer {
  uses IOPort   pit_command;
  uses IOPort   pit_channel0;
  has mutex     timer;
  consumes DataAvailable  irq;

  emits sig Hello1_Thr_activator;
  emits sig Hello2_Thr_activator;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;Timerbase&lt;/code&gt; component accesses two &lt;code class=&quot;highlighter-rouge&quot;&gt;IOPort&lt;/code&gt; that are hardware register/memories used to control the timer. This is architecture-dependent and related to the &lt;abbr title=&quot;Programmable Interval Interrupt&quot;&gt;PIT&lt;/abbr&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;irq&lt;/code&gt; corresponds to the interrupt sent by the system.&lt;/p&gt;

&lt;p&gt;Now, let’s define the application component (application task). We call it &lt;code class=&quot;highlighter-rouge&quot;&gt;HelloThreadImpl&lt;/code&gt;. This task is a control task that will consumes a signal that activates it.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;component HelloThreadImpl
{
  control;
  consumes sig activator;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then, we need to create an assembly that integrates and configures all components. The assembly corresponds to the components configuration showed in the picture before.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import &amp;lt;std_connector.camkes&amp;gt;;
import &quot;components/timer/Timer.camkes&quot;;
import &quot;components/HelloThreadImpl/HelloThreadImpl.camkes&quot;;
assembly {
  composition {
    component Timerbase timerbase;
    component Timer timer;


    component HelloThreadImpl Hello1_Thr;
    component HelloThreadImpl Hello2_Thr;

    connection seL4Notification notification0
     (from timer.Hello1_Thr_activator, to Hello1_Thr.activator);
                connection seL4Notification notification1 (from timer.Hello2_Thr_activator, to Hello2_Thr.activator);

    connection seL4HardwareInterrupt timer_irq
      (from timerbase.irq, to timer.irq);

    connection seL4HardwareIOPort pit_command
      (from timer.pit_command, to timerbase.command);

  connection seL4HardwareIOPort pit_channel0
      (from timer.pit_channel0, to timerbase.channel0);
  }

  configuration {
    timerbase.irq_attributes = 0;
    timerbase.command_attributes = &quot;0x43:0x43&quot;;
    timerbase.channel0_attributes = &quot;0x40:0x40&quot;;
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We define the timer component (one of type &lt;code class=&quot;highlighter-rouge&quot;&gt;Timerbase&lt;/code&gt; and one of type &lt;code class=&quot;highlighter-rouge&quot;&gt;Timer&lt;/code&gt;) as well as two software components. The connections &lt;code class=&quot;highlighter-rouge&quot;&gt;notification0&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;notification1&lt;/code&gt; are the one that will activate the tasks through a signal, to notify them that they can be activated.&lt;/p&gt;

&lt;p&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;configuration&lt;/code&gt; section, the hardware component is configured. This part is architecture-dependent and if you are planning to use such a pattern on another architecture, you would need to adapt the hardware component specification and its relative configuration section.&lt;/p&gt;

&lt;h2 id=&quot;implementing-the-code&quot;&gt;Implementing the code&lt;/h2&gt;

&lt;p&gt;Now, we need to implement the &lt;code class=&quot;highlighter-rouge&quot;&gt;Timer&lt;/code&gt; and the &lt;code class=&quot;highlighter-rouge&quot;&gt;HelloThreadImpl&lt;/code&gt; components.&lt;/p&gt;

&lt;p&gt;For the timer, there is a part that is architecture-dependent and another that is generic and activates the tasks. We will skip the architecture-dependent part, you can look at it in the code by yourself. The most interesting part is in the interrupt handler.&lt;/p&gt;

&lt;p&gt;In the driver interrupt handler, we get the current time in milliseconds. Then, depending on the value, we send a signal to activate a task. In the following code, we send a signal to the first task every 1000 ms and send a signal to the second task every 2000 ms.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;void irq_callback(void *_ UNUSED)
{
  timer_handle_irq(timer_drv, 0);

  uint64_t ms = current_time_ms();

  if ( ( ms % 1000) == 0)
  {
    Hello1_Thr_activator_emit();
  }

  if ( ( ms % 2000) == 0)
  {
    Hello2_Thr_activator_emit();
  }

  irq_reg_callback(irq_callback, NULL);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s have a look at the &lt;code class=&quot;highlighter-rouge&quot;&gt;HelloThreadImpl&lt;/code&gt; code now. It should be pretty obvious with an infinite loop waiting for a signal and executing a piece of code. The code is provided below.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;camkes.h&amp;gt;

#include &amp;lt;generatedtypes.h&amp;gt;
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;string.h&amp;gt;

void user_hello_spg ()
{
  printf *&quot;HELLO\n&quot;);
}

int run(void)
{
  while (1)
  {
    activator_wait();
    user_hello_spg ( );
  }
  return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;getting-the-code--run-it&quot;&gt;Getting the code &amp;amp; run it&lt;/h1&gt;
&lt;p&gt;The code is availabe &lt;a href=&quot;/assets/sel4-timer.tgz&quot;&gt;there&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you want to run it:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Check out CAmkES and make sure it works on your system. To get started, have a look &lt;a href=&quot;https://wiki.sel4.systems/CAmkES&quot;&gt;on the instruction on the seL4 wiki&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Get the code &lt;a href=&quot;/assets/sel4-timer.tgz&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;decompress the archive into the &lt;code class=&quot;highlighter-rouge&quot;&gt;apps/&lt;/code&gt; directory of the CAmkES installation&lt;/li&gt;
  &lt;li&gt;Edit the &lt;code class=&quot;highlighter-rouge&quot;&gt;Kconfig&lt;/code&gt; file at the root directory of your CAmkES installation and add in the &lt;code class=&quot;highlighter-rouge&quot;&gt;Applications&lt;/code&gt; section the following line: &lt;code class=&quot;highlighter-rouge&quot;&gt;source &quot;apps/twotasksx86instance/Kconfig&quot;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;invoke &lt;code class=&quot;highlighter-rouge&quot;&gt;make ia32_simple_defconfig&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;invoke &lt;code class=&quot;highlighter-rouge&quot;&gt;make oldconfig&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;invoke &lt;code class=&quot;highlighter-rouge&quot;&gt;make&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;If everything compiles fine, it means that a simple example for the ia32 platform works. We can then compiles the example from this article&lt;/li&gt;
  &lt;li&gt;Invoke &lt;code class=&quot;highlighter-rouge&quot;&gt;make menuconfig&lt;/code&gt;. In the menu, in the &lt;code class=&quot;highlighter-rouge&quot;&gt;Applications&lt;/code&gt; section, unselect all examples and select &lt;code class=&quot;highlighter-rouge&quot;&gt;Generated CAmkES TwotasksX86Instance application &lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;exit the configuration tool and save the changes&lt;/li&gt;
  &lt;li&gt;invoke &lt;code class=&quot;highlighter-rouge&quot;&gt;make&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;simulate the system with qemu by invoking &lt;code class=&quot;highlighter-rouge&quot;&gt;qemu-system-i386 -nographic -kernel images/kernel-ia32-pc99 -initrd images/capdl-loader-experimental-image-ia32-pc99&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When running the code, you should just see that you get more output every two seconds. Basically, every second, you get two &lt;em&gt;HELLO&lt;/em&gt; message on the console while every two seconds, you see two messages.&lt;/p&gt;

&lt;h1 id=&quot;issues--limitations&quot;&gt;Issues &amp;amp; limitations&lt;/h1&gt;
&lt;p&gt;In this post, I tried to explain how to use seL4 and its related &lt;abbr title=&quot;Architecture Description Language&quot;&gt;ADL&lt;/abbr&gt; in order to implement a popular design pattern for safety-critical systems: a periodic tasks. As seL4 provides very minimal services and as no built-in timing service, you must define them yourself.&lt;/p&gt;

&lt;p&gt;Beyond that, one can notice that there is some issues with such an approach. First of all, it assumes that the system is &lt;em&gt;schedulable&lt;/em&gt; and that all tasks will complete their job and will not interfere with the execution of the other tasks. If one task that is at a high priority takes all the CPU (in other word, if the code in &lt;code class=&quot;highlighter-rouge&quot;&gt;user_hello_spg&lt;/code&gt; contains an infinite loop), your system will be stuck. One workaround would be to use the concept of domains in seL4 but unfortunately, it does not seem that CAmkES exports it to the user. Also, the system does not &lt;em&gt;enforce&lt;/em&gt; any timing budget. The NICTA team is working on some real-time extensions that might provide such services.&lt;/p&gt;

&lt;p&gt;Note: You might find some error/bugs in the code, this is mostly done for educational purposes. If you find any issue/bug, do not hesitate to contact me.&lt;/p&gt;

</description>
        <pubDate>Mon, 18 Apr 2016 06:13:20 -0700</pubDate>
        <link>http://julien.gunnm.org/geek/sel4/2016/04/18/periodic-tasks-with-sel4/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/geek/sel4/2016/04/18/periodic-tasks-with-sel4/</guid>
        
        <category>sel4</category>
        
        <category>real-time</category>
        
        <category>CAmkES</category>
        
        
        <category>geek</category>
        
        <category>sel4</category>
        
      </item>
    
      <item>
        <title>BeagleBoard Black (BBB) and GPIO</title>
        <description>&lt;p&gt;When you buy a &lt;a href=&quot;http://beagleboard.org/black&quot;&gt;Beagleboard Black&lt;/a&gt; (a.k.a. BBB), it comes with a pre-installed version of debian with more or less everything you need to get started. I purchased the board for another purpose and develop seL4 components on top of it. But before starting to develop on seL4, it is useful to know exactly how the board works: once you know how the board works, you can start to write your code and know for sure that the bug comes from your code.&lt;/p&gt;
&lt;p&gt;In this article, I will explain quickly how to set up a simple circuit to test the GPIO of the beaglebone.&lt;/p&gt;


&lt;img class=&quot;  wp-image-2231 aligncenter&quot; src=&quot;/assets/cape-headers-digital.png&quot; alt=&quot;cape-headers-digital.png&quot; width=&quot;300&quot; height=&quot;225&quot; /&gt;

&lt;p&gt;Mapping between pin numbers and GPIO ID from&lt;a href=&quot;http://beagleboard.org/support/bone101&quot;&gt; bone 101&lt;/a&gt;
&lt;/p&gt;

&lt;h1&gt;Setting up the circuit&lt;/h1&gt;
&lt;p&gt;To test the circuit, you need only a breadboard, a resistance and a LED. Simple.&lt;/p&gt;
&lt;p&gt;Connect the PIN 14 (which is mapped to GPIO id 50, see table) from bank P9 (green cable on the picture) on the breadboard. Connect it to a resistance and a LED. The other pin of the LED is then connected to the ground (last PIN of P9).&lt;/p&gt;

&lt;img class=&quot;  wp-image-2224 aligncenter&quot; src=&quot;/assets/board.jpg&quot; alt=&quot;board&quot; width=&quot;460&quot; height=&quot;345&quot; /&gt;
&lt;p&gt;Wiring scheme of the example&lt;/p&gt;


&lt;h1&gt;Controlling the GPIO in Linux&lt;/h1&gt;
&lt;p&gt;In Linux, the GPIO can be controlled using the SysFS abstraction layer. You can access it through&lt;em&gt; /sys/class/gpio. &lt;/em&gt;I am using the pre-installed debian software on the board.&lt;/p&gt;
&lt;p&gt;To control a particular pin, you must export it. You do it by writing the value of the pin you want to export into &lt;em&gt;/sys/class/gpio/export&lt;/em&gt;. Then, a new directory is &lt;em&gt;/sys/class/gpio/gpio&amp;lt;PIN-NUMBER&amp;gt;&lt;/em&gt; is created with many different files to control the pin (direction, value, etc.).&lt;/p&gt;
&lt;p&gt;In our example, the &lt;strong&gt;pin 14 from the bank P9&lt;/strong&gt; correspond to &lt;strong&gt;GPIO 50&lt;/strong&gt;. You can see the corresponding mapping between the pin and GPIO number in the &lt;a href=&quot;http://beagleboard.org/support/bone101&quot;&gt;beaglebone 101 &lt;/a&gt;document.&lt;/p&gt;
&lt;p&gt;So, let's start by exporting this pin:&lt;/p&gt;
&lt;pre&gt;echo 50 &amp;gt; /sys/class/gpio/export&lt;/pre&gt;
&lt;p&gt;Then, a new directory /sys/class/gpio/gpio50 is created.&lt;/p&gt;
&lt;p&gt;Let's set its direction to out&lt;/p&gt;
&lt;pre&gt;echo out &amp;gt; /sys/class/gpio/gpio50/direction&lt;/pre&gt;
&lt;p&gt;And let's set its value to 1&lt;/p&gt;
&lt;pre&gt;echo 1 &amp;gt; /sys/class/gpio/gpio50/value&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;And finally, if you want to make the LED blinks every second, you can use this command:&lt;/p&gt;
&lt;pre&gt;while [ 1 ]; do echo 1 &amp;gt; /sys/class/gpio/gpio50/value ; sleep 1 ; echo 0 &amp;gt; /sys/class/gpio/gpio50/value ; sleep 1 ; done&lt;/pre&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;https://www.youtube.com/watch?v=k-g114EUXaE&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h1&gt;Sources&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;How to use GPIO as outputs &lt;a href=&quot;http://www.dummies.com/how-to/content/setting-beaglebone-gpios-as-outputs.html&quot;&gt;http://www.dummies.com/how-to/content/setting-beaglebone-gpios-as-outputs.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;GPIO programming on the beaglebone: &lt;a href=&quot;http://elinux.org/images/3/33/GPIO_Programming_on_the_Beaglebone.pdf&quot;&gt;http://elinux.org/images/3/33/GPIO_Programming_on_the_Beaglebone.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;BeagleBone 101: &lt;a href=&quot;http://beagleboard.org/support/bone101&quot;&gt;http://beagleboard.org/support/bone101&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sun, 21 Feb 2016 11:34:43 -0800</pubDate>
        <link>http://julien.gunnm.org/geek/misc/programming/2016/02/21/beagleboard-black-bbb-and-gpio/</link>
        <guid isPermaLink="true">http://julien.gunnm.org/geek/misc/programming/2016/02/21/beagleboard-black-bbb-and-gpio/</guid>
        
        
        <category>geek</category>
        
        <category>misc</category>
        
        <category>programming</category>
        
      </item>
    
  </channel>
</rss>
